<div class="topline">
  <a href="https://wa.me/51970766227" target="_blank" rel="noopener noreferrer" class="topline-link">
    <i class="bi bi-whatsapp"></i>
    <span>Contáctanos</span>
  </a>
</div>

<mat-toolbar class="app-navbar">
  <a routerLink="/" class="navbar-brand-button">
    <img src="assets/img/logocrisol.png" alt="Logo de la Librería" class="navbar-logo-image">
  </a>

  <span class="navbar-center-spacer-left"></span>
  <span class="navbar-center-spacer-right"></span>

  <div class="navbar-right-section">
    
    <!-- Bloque NO Logueado -->
    <ng-container *ngIf="(isLoggedIn$ | async) === false">
      <button mat-button routerLink="/login" class="navbar-nav-button icon-button">
        <i class="bi bi-person navbar-nav-icon"></i>
        <span class="icon-button-text">Ingresar</span>
      </button>
    </ng-container>

    <!-- Bloque Logueado -->
    <ng-container *ngIf="(isLoggedIn$ | async) === true">
      
      <!-- Botón que abre el menú -->
      <button mat-button
              [matMenuTriggerFor]="userOptionsMenu"
              class="navbar-nav-button icon-button">
        <i class="bi bi-person-fill navbar-nav-icon"></i>
        <span class="icon-button-text">Hola, {{ (currentUser$ | async)?.nombres }}</span>
      </button>

      <!-- Menú Desplegable -->
      <!-- Quitamos el div intermedio y los mouseleave conflictivos -->
      <mat-menu #userOptionsMenu="matMenu" class="app-menu-panel">
        
        <!-- Opción: Lista de Deseos -->
        <button mat-menu-item routerLink="/mi-lista-deseos" class="app-menu-item">
          <i class="bi bi-heart-fill app-menu-item-icon" style="color: #e91e63;"></i>
          <span>Mi Lista de Deseos</span>
        </button>

        <!-- Opción: Mis Pedidos -->
        <button mat-menu-item routerLink="/mis-pedidos" class="app-menu-item">
          <i class="bi bi-receipt-fill app-menu-item-icon"></i>
          <span>Mis Pedidos</span>
        </button>

        <!-- Opción: Admin (Solo si es admin) -->
        <button mat-menu-item *ngIf="isAdmin$ | async" routerLink="/admin" class="app-menu-item">
          <i class="bi bi-gear-fill app-menu-item-icon"></i>
          <span>Admin</span>
        </button>

        <!-- Opción: Cerrar Sesión -->
        <button mat-menu-item (click)="logout()" class="app-menu-item">
          <i class="bi bi-box-arrow-right app-menu-item-icon"></i>
          <span>Cerrar Sesión</span>
        </button>
        
      </mat-menu>
    </ng-container>

    <!-- Botón del Carrito -->
    <button mat-button routerLink="/carrito"
            [matBadge]="cartItemCount$ | async"
            [matBadgeHidden]="(cartItemCount$ | async) === 0"
            matBadgeColor="warn"
            matBadgePosition="above after"
            class="navbar-nav-button icon-button">
      <i class="bi bi-cart-fill navbar-nav-icon"></i>
      <span class="icon-button-text">Carrito</span>
    </button>
  </div>
</mat-toolbar>

<div class="main-content">
  <router-outlet></router-outlet>
</div>

<footer class="app-footer">
  <div class="footer-content">
    <p>&copy; 2025 Librería Crisol. Todos los derechos reservados.</p>
    <div class="footer-social-icons">
      <a href="https://www.facebook.com/libreriascrisol.paginaoficial" target="_blank" class="social-icon" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
      <a href="https://twitter.com/LibreriasCrisol" target="_blank" class="social-icon" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
      <a href="https://www.instagram.com/libreriascrisol" target="_blank" class="social-icon" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
    </div>
  </div>
</footer>
